{"version":3,"sources":["daemon.config.ts","core/services/list.service.ts","types/server-metadata.type.ts","types/link-list.type.ts","api-introspection/index.ts","core/services/child.service.ts","core/services/daemon.service.ts","core/interceptors/notify.interceptor.ts","server.controller.ts","core/core.module.ts","server.module.ts","core/services/plugin-watcher.service.ts","core/services/plugin-loader.service.ts","main.ts"],"names":[],"mappings":"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","file":"main.js","sourceRoot":"../../src/daemon-server","sourcesContent":["import { homedir } from \"os\";\n\nexport const GAPI_MAIN_FOLDER = `${homedir()}/.gapi`;\nexport const GAPI_DAEMON_FOLDER = `${GAPI_MAIN_FOLDER}/daemon`;\nexport const GAPI_DAEMON_PROCESS_LIST_FOLDER = `${GAPI_DAEMON_FOLDER}/process-list`;\nexport const GAPI_DAEMON_PLUGINS_FOLDER = `${GAPI_DAEMON_FOLDER}/plugins`;\nexport const GAPI_DAEMON_EXTERNAL_PLUGINS_FOLDER = `${GAPI_DAEMON_FOLDER}/external-plugins`;\nexport const GAPI_DAEMON_CACHE_FOLDER = `${GAPI_DAEMON_FOLDER}/.cache`;\nexport const IPFS_HASHED_MODULES = `${GAPI_DAEMON_FOLDER}/ipfs-hash-list`;","import { Injectable } from '@rxdi/core';\nimport { promisify } from 'util';\nimport { readFile } from 'fs';\nimport { ILinkListType } from '../../api-introspection/index';\nimport { GAPI_DAEMON_PROCESS_LIST_FOLDER } from '../../daemon.config';\n\n@Injectable()\nexport class ListService {\n  private linkedList: ILinkListType[] = [];\n\n  async readList() {\n    try {\n      this.linkedList = JSON.parse(\n        await promisify(readFile)(GAPI_DAEMON_PROCESS_LIST_FOLDER, {\n          encoding: 'utf-8'\n        })\n      );\n    } catch (e) {}\n    return this.linkedList;\n  }\n\n  async findByRepoPath(repoPath: string) {\n    return (await this.readList()).filter(l => l.repoPath === repoPath);\n  }\n\n  findByLinkName(linkName: string) {\n    return {\n      results: async () =>\n        (await this.readList()).filter(l => l.linkName === linkName),\n      exclude: async (isNotLike: string) =>\n        (await this.readList()).filter(\n          l => l.linkName === linkName && l.repoPath !== isNotLike\n        )\n    };\n  }\n}\n","import { GraphQLObjectType, GraphQLInputObjectType, GraphQLInt } from 'graphql';\n\nexport const ServerMetadataType = new GraphQLObjectType({\n  name: 'ServerMetadataType',\n  fields: () => ({\n    port: {\n      type: GraphQLInt\n    }\n  })\n});\n\nexport const ServerMetadataInputType = new GraphQLInputObjectType({\n  name: 'ServerMetadataInputType',\n  fields: () => ({\n    port: {\n      type: GraphQLInt\n    }\n  })\n});\n","import { GraphQLObjectType, GraphQLString } from 'graphql';\nimport { ServerMetadataType } from './server-metadata.type';\n\nexport const LinkListType = new GraphQLObjectType({\n  name: 'LinkListType',\n  fields: () => ({\n    repoPath: {\n      type: GraphQLString\n    },\n    introspectionPath: {\n      type: GraphQLString\n    },\n    linkName: {\n      type: GraphQLString\n    },\n    serverMetadata: {\n      type: ServerMetadataType\n    }\n  })\n});\n","// tslint:disable\n// graphql typescript definitions\n\n\n  export interface IGraphQLResponseRoot {\n    data?: IQuery | IMutation | ISubscription;\n    errors?: Array<IGraphQLResponseError>;\n  }\n\n  export interface IGraphQLResponseError {\n    message: string;            // Required for all errors\n    locations?: Array<IGraphQLResponseErrorLocation>;\n    [propName: string]: any;    // 7.2.2 says 'GraphQL servers may provide additional entries to error'\n  }\n\n  export interface IGraphQLResponseErrorLocation {\n    line: number;\n    column: number;\n  }\n\n  /**\n    description: Query type for all get requests which will not change persistent data\n  */\n  export interface IQuery {\n    __typename?: \"Query\";\n    status: IStatusQueryType | null;\n    initQuery: ICustomControllerType | null;\n    getLinkList: Array<ILinkListType> | null;\n}\n\n  \n  export interface IStatusQueryType {\n    __typename?: \"StatusQueryType\";\n    status: string | null;\n}\n\n  \n  export interface ICustomControllerType {\n    __typename?: \"CustomControllerType\";\n    init: string | null;\n}\n\n  \n  export interface ILinkListType {\n    __typename?: \"LinkListType\";\n    repoPath: string | null;\n    introspectionPath: string | null;\n    linkName: string | null;\n    serverMetadata: IServerMetadataType | null;\n}\n\n  \n  export interface IServerMetadataType {\n    __typename?: \"ServerMetadataType\";\n    port: number | null;\n}\n\n  /**\n    description: Mutation type for all requests which will change persistent data\n  */\n  export interface IMutation {\n    __typename?: \"Mutation\";\n    notifyDaemon: ILinkListType | null;\n}\n\n  \n  export interface IServerMetadataInputType {\n    port?: number | null;\n}\n\n  /**\n    description: Subscription type for all subscriptions via pub sub\n  */\n  export interface ISubscription {\n    __typename?: \"Subscription\";\n    statusSubscription: ILinkListType | null;\n}\n\n\n// tslint:enable\n","import { Injectable } from '@rxdi/core';\nimport { spawn } from 'child_process';\n\n@Injectable()\nexport class ChildService {\n  spawn(\n    command: string,\n    args: string[],\n    cwd: string,\n    wait: number = 30 * 1000\n  ) {\n    return new Promise((resolve, reject) => {\n      const child = spawn(command, args, { cwd, detached: true });\n      const timeout = setTimeout(() => {\n        const message = `${command} ${args.toString()} exited with timeout after ${wait /\n          1000} seconds`;\n        child.kill(message);\n        reject(message);\n        clearTimeout(timeout);\n      }, wait);\n      child.stdout.on('data', data => process.stdout.write(data));\n      child.stderr.on('data', data => process.stderr.write(data));\n      child.on('close', code => {\n        clearTimeout(timeout);\n        if (!code) {\n          resolve(code);\n        } else {\n          reject(code);\n        }\n      });\n    });\n  }\n}\n","import { Service } from '@rxdi/core';\nimport { exists, writeFile, readFile } from 'fs';\nimport { promisify } from 'util';\nimport { ILinkListType } from '../../api-introspection';\nimport { from, of, combineLatest } from 'rxjs';\nimport { map, switchMap } from 'rxjs/operators';\nimport { ListService } from './list.service';\nimport { ChildService } from './child.service';\nimport { GAPI_DAEMON_PROCESS_LIST_FOLDER } from '../../daemon.config';\nconst { mkdirp } = require('@rxdi/core/dist/services/file/dist');\n\n@Service()\nexport class DaemonService {\n  private noop = of([] as ILinkListType[]);\n  constructor(\n    private listService: ListService,\n    private childService: ChildService\n  ) {}\n\n  notifyDaemon(payload: ILinkListType) {\n    return this.findByRepoPath(payload).pipe(\n      switchMap(([mainNode]) =>\n        this.saveMainNode(\n          Object.assign(mainNode ? mainNode : ({} as any), {\n            serverMetadata: payload.serverMetadata\n          })\n        )\n      ),\n      switchMap(mainNode => this.findLinkedRepos(mainNode)),\n      switchMap(otherRepos =>\n        combineLatest([\n          this.trigger(payload),\n          ...otherRepos.map(r =>\n            this.trigger(\n              Object.assign(r, { serverMetadata: payload.serverMetadata })\n            )\n          )\n        ])\n      ),\n      map(() => payload)\n    );\n  }\n\n  private async trigger(payload: ILinkListType): Promise<ILinkListType> {\n    if (!(await promisify(exists)(payload.repoPath))) {\n      await promisify(mkdirp)(payload.repoPath);\n    }\n    const gapiLocalConfig = `${payload.repoPath}/gapi-cli.conf.yml`;\n    if (!(await promisify(exists)(gapiLocalConfig))) {\n      await this.writeGapiCliConfig(gapiLocalConfig, payload);\n    }\n    const args = [\n      'schema',\n      'introspect',\n      '--collect-documents',\n      '--collect-types'\n    ];\n    await this.childService.spawn('gapi', args, payload.repoPath);\n    return payload;\n  }\n\n  private async saveMainNode(payload: ILinkListType) {\n    let processList: ILinkListType[] = [];\n    const encoding = 'utf8';\n    try {\n      processList = JSON.parse(\n        await promisify(readFile)(GAPI_DAEMON_PROCESS_LIST_FOLDER, { encoding })\n      );\n    } catch (e) {}\n    await promisify(writeFile)(\n      GAPI_DAEMON_PROCESS_LIST_FOLDER,\n      JSON.stringify(\n        processList.filter(p => p.repoPath !== payload.repoPath).concat(payload)\n      ),\n      { encoding }\n    );\n    return payload;\n  }\n  private async writeGapiCliConfig(gapiLocalConfig, payload: ILinkListType) {\n    let port = 9000;\n    if (payload.serverMetadata.port) {\n      port = payload.serverMetadata.port;\n    }\n    return await promisify(writeFile)(\n      gapiLocalConfig,\n      `\nconfig:\n  schema:\n    introspectionEndpoint: http://localhost:${port}/graphql\n    introspectionOutputFolder: ./api-introspection\n`\n    );\n  }\n  private findByRepoPath(payload: ILinkListType) {\n    return from(this.listService.readList()).pipe(\n      switchMap(list =>\n        list.length\n          ? this.listService.findByRepoPath(payload.repoPath)\n          : this.noop\n      )\n    );\n  }\n  private findLinkedRepos(repo: ILinkListType) {\n    return repo && repo.linkName\n      ? this.listService.findByLinkName(repo.linkName).exclude(repo.repoPath)\n      : this.noop;\n  }\n}\n","import { InterceptResolver, Injectable, GenericGapiResolversType } from '@gapi/core';\nimport { Observable } from 'rxjs';\nimport { tap } from 'rxjs/operators';\nimport { ILinkListType } from '../../../daemon-server/api-introspection';\nimport notifier = require('node-notifier');\n\n@Injectable()\nexport class NotifyInterceptor implements InterceptResolver {\n    intercept(\n        chainable$: Observable<any>,\n        context,\n        payload: ILinkListType,\n        descriptor: GenericGapiResolversType\n    ) {\n        console.log('Before...');\n        const options = { timeout: 2 }\n        // notifier.notify({\n        //     'title': `Daemon triggered!`,\n        //     'message': `${payload.repoPath}`,\n        //     ...options\n        // });\n        const now = Date.now();\n        return chainable$.pipe(\n            tap(() => console.log(`After... ${Date.now() - now}ms`)),\n            // tap(() => notifier.notify({\n            //     'title': 'Daemon finished!',\n            //     'message': `Request took ${Date.now() - now}ms`,\n            //     ...options\n            // }))\n        );\n    }\n}","import {\n  Controller,\n  PubSubService,\n  Type,\n  Query,\n  GraphQLList,\n  Mutation,\n  GraphQLString,\n  GraphQLNonNull,\n  Interceptor,\n  Subscription,\n  Subscribe\n} from '@gapi/core';\nimport { ListService } from './core/services/list.service';\nimport { LinkListType } from './types/link-list.type';\nimport { ILinkListType } from './api-introspection';\nimport { DaemonService } from './core/services/daemon.service';\nimport { Observable } from 'rxjs';\nimport { ServerMetadataInputType } from './types/server-metadata.type';\nimport { NotifyInterceptor } from './core/interceptors/notify.interceptor';\n\n@Controller()\nexport class ServerController {\n  constructor(\n    private listService: ListService,\n    private daemonService: DaemonService,\n    private pubsub: PubSubService\n  ) {\n    let count = 0;\n    setInterval(() => {\n      pubsub.publish('CREATE_SIGNAL_BASIC', count++);\n    }, 2000);\n  }\n\n  @Type(LinkListType)\n  @Subscribe((self: ServerController) => self.pubsub.asyncIterator('CREATE_SIGNAL_BASIC'))\n  @Interceptor(NotifyInterceptor)\n  @Subscription()\n  statusSubscription(message) {\n    return {\n      repoPath: message\n    }\n  }\n\n  @Type(new GraphQLList(LinkListType))\n  @Query()\n  getLinkList() {\n    return this.listService.readList();\n  }\n\n  @Type(LinkListType)\n  @Interceptor(NotifyInterceptor)\n  @Mutation({\n    repoPath: {\n      type: new GraphQLNonNull(GraphQLString)\n    },\n    introspectionPath: {\n      type: GraphQLString\n    },\n    linkName: {\n      type: GraphQLString\n    },\n    serverMetadata: {\n      type: ServerMetadataInputType\n    }\n  })\n  notifyDaemon(root, payload: ILinkListType): Observable<ILinkListType> {\n    return this.daemonService.notifyDaemon(payload);\n  }\n}\n","import { Module } from '@rxdi/core';\nimport { ListService } from './services/list.service';\nimport { DaemonService } from './services/daemon.service';\nimport { ChildService } from './services/child.service';\n\n@Module({\n  services: [ListService, DaemonService, ChildService]\n})\nexport class CoreModule {}\n","import { Module } from '@gapi/core';\nimport { ServerController } from './server.controller';\nimport { CoreModule } from './core/core.module';\n\n@Module({\n  imports: [CoreModule],\n  controllers: [ServerController]\n})\nexport class ServerModule {}\n","import { Injectable } from '@rxdi/core';\nimport { watch } from 'chokidar';\nimport {\n  GAPI_DAEMON_EXTERNAL_PLUGINS_FOLDER,\n  GAPI_DAEMON_PLUGINS_FOLDER,\n  IPFS_HASHED_MODULES\n} from '../../daemon.config';\nimport { ChildService } from './child.service';\nimport { Observable } from 'rxjs';\n\n@Injectable()\nexport class PluginWatcherService {\n\n  constructor(\n      private childService: ChildService\n    ) {}\n\n  private isNotFromExternalPlugins(path: string) {\n    return !path.includes('external-plugins')\n  }\n  watch() {\n    return new Observable<string[]>(observer => {\n      const initPlugins: string[] = [];\n      let isInitFinished = false;\n      const watcher = watch(\n        [\n          `${GAPI_DAEMON_EXTERNAL_PLUGINS_FOLDER}/**/*.js`,\n          `${GAPI_DAEMON_PLUGINS_FOLDER}/**/*.js`,\n          IPFS_HASHED_MODULES,\n        ],\n        {\n          ignored: /^\\./,\n          persistent: true\n        }\n      );\n      watcher\n        .on('add', (path: string) => {\n          if (!isInitFinished && this.isNotFromExternalPlugins(path)) {\n            console.log('Plugin', path, 'has been added');\n              initPlugins.push(path);\n          } else {\n            console.log('Present external module', path);\n          }\n          if (isInitFinished && this.isNotFromExternalPlugins(path)) {\n            this.restartDaemon();\n          }\n        })\n        .on('change', (path: string) => {\n          console.log('File', path, 'has been changed');\n          if (isInitFinished) {\n            this.restartDaemon();\n          }\n        })\n        .on('ready', () => {\n          console.log('Initial scan complete. Ready for changes');\n          observer.next(initPlugins);\n          observer.complete();\n          isInitFinished = true;\n        })\n        .on('unlink', path => {\n          console.log('File', path, 'has been removed');\n          if (isInitFinished) {\n            this.restartDaemon();\n          }\n        })\n        .on('error', error => console.error('Error happened', error));\n    });\n  }\n\n  private async restartDaemon() {\n    await this.childService.spawn(\n      'gapi',\n      ['daemon', 'restart'],\n      process.cwd()\n    );\n    process.exit();\n  }\n\n}\n","import {\n  Injectable,\n  ExternalImporter,\n  ExternalModuleConfiguration,\n  FileService,\n  Metadata\n} from \"@rxdi/core\";\nimport { take, switchMap, map, combineLatest, tap } from \"rxjs/operators\";\nimport { of, Subject } from \"rxjs\";\nimport {\n  GAPI_DAEMON_EXTERNAL_PLUGINS_FOLDER,\n  GAPI_DAEMON_PLUGINS_FOLDER,\n  IPFS_HASHED_MODULES\n} from \"../../daemon.config\";\nimport { PluginWatcherService } from \"./plugin-watcher.service\";\nimport { readFileSync, writeFile, exists } from \"fs\";\nimport { promisify } from \"util\";\n\ninterface CustomMetadata extends Function {\n  metadata: Metadata;\n}\n\n@Injectable()\nexport class PluginLoader {\n  private defaultIpfsProvider = \"https://ipfs.io/ipfs/\";\n  private defaultDownloadFilename = \"gapi-plugin\";\n\n  fileWatcher: Subject<string[]> = new Subject();\n  cache: { [key: string]: CustomMetadata } = {};\n\n  constructor(\n    private externalImporterService: ExternalImporter,\n    private fileService: FileService,\n    private pluginWatcherService: PluginWatcherService\n  ) {}\n\n  getModule(hash: string, provider: string = this.defaultIpfsProvider) {\n    if (this.isModuleHashed(hash)) {\n      return this.cache[hash];\n    }\n    return this.externalImporterService\n      .downloadIpfsModuleConfig({\n        hash,\n        provider\n      })\n      .pipe(\n        take(1),\n\n        switchMap((externalModule: ExternalModuleConfiguration) =>\n          this.externalImporterService.importModule(\n            {\n              fileName: this.defaultDownloadFilename,\n              namespace: externalModule.name,\n              extension: \"js\",\n              outputFolder: `${GAPI_DAEMON_EXTERNAL_PLUGINS_FOLDER}/`,\n              link: `${this.defaultIpfsProvider}${externalModule.module}`\n            },\n            externalModule.name,\n            { folderOverride: `//` }\n          )\n        ),\n        map((data: Function) => {\n          const currentModule = this.loadModule(data);\n          this.cache[hash] = currentModule;\n          return currentModule;\n        })\n      );\n  }\n\n  private isModuleHashed(hash: string) {\n    return !!this.cache[hash];\n  }\n\n  private cacheModule(currentModule: CustomMetadata) {\n    if (currentModule.metadata) {\n      this.cache[currentModule.metadata.moduleHash] = currentModule;\n    }\n  }\n\n  private loadModule(m: Function): CustomMetadata {\n    const currentModule: CustomMetadata = m[Object.keys(m)[0]];\n    if (!currentModule) {\n      throw new Error(`Missing cache module ${JSON.stringify(m)}`);\n    }\n    this.cacheModule(currentModule);\n    return currentModule;\n  }\n\n  private async makeIpfsHashFile() {\n    if (!(await promisify(exists)(IPFS_HASHED_MODULES))) {\n      await promisify(writeFile)(IPFS_HASHED_MODULES, JSON.stringify([], null, 4), { encoding: 'utf8' });\n    }\n  }\n\n  private makePluginsDirectories() {\n    return of(true).pipe(\n      switchMap(() =>\n        this.fileService.mkdirp(GAPI_DAEMON_EXTERNAL_PLUGINS_FOLDER)\n      ),\n      switchMap(() => this.fileService.mkdirp(GAPI_DAEMON_PLUGINS_FOLDER)),\n      switchMap(() => this.makeIpfsHashFile()),\n    );\n  }\n\n  loadIpfsHashes() {\n    let hashes = [];\n    try {\n      hashes = JSON.parse(readFileSync(IPFS_HASHED_MODULES, { encoding: 'utf8' }));\n    } catch (e) {}\n    return hashes;\n  }\n\n  loadPlugins() {\n    return this.makePluginsDirectories().pipe(\n      switchMap(() => this.pluginWatcherService.watch()),\n      // switchMap(() => this.fileService.fileWalker(pluginsFolder)),\n      map(p =>\n        [...new Set(p)].map(path =>\n          !new RegExp(/^(.(?!.*\\.js$))*$/g).test(path)\n            ? this.loadModule(require(path))\n            : null\n        )\n      ),\n      switchMap(pluginModules =>\n        of(null).pipe(\n          combineLatest(\n            [...new Set(this.loadIpfsHashes())].map(hash => this.getModule(hash))\n          ),\n          map(externalModules => externalModules.concat(pluginModules)),\n          map(m => m.filter(i => !!i)),\n          map((modules: CustomMetadata[]) => this.filterDups(modules))\n        )\n      )\n    );\n  }\n\n  private filterDups(modules: CustomMetadata[]) {\n    return [...new Set(modules.map(i => i.metadata.moduleHash))].map(\n      m => {\n        console.log(m);\n        return this.cache[m];\n      }\n    );\n  }\n}\n","import { setup } from '@rxdi/core';\nimport { ServerModule } from './server.module';\nimport { CoreModule } from '@gapi/core';\nimport { Container } from '@gapi/core';\nimport { switchMap } from 'rxjs/operators';\nimport { PluginLoader } from './core/services/plugin-loader.service';\nimport { PluginWatcherService } from './core/services/plugin-watcher.service';\n\nContainer.get(PluginLoader)\n  .loadPlugins()\n  .pipe(\n    switchMap(pluginModules =>\n      setup({\n        imports: [\n          ...pluginModules,\n          CoreModule.forRoot({\n            server: {\n              hapi: {\n                port: 42001\n              }\n            },\n            graphql: {\n              graphiql: true,\n              openBrowser: true,\n              graphiQlPlayground: false\n            },\n            // pubsub: {\n            //   host: 'localhost',\n            //   port: 5672,\n            //   log: true,\n            //   activateRabbitMQ: true\n            // },\n            daemon: {\n              activated: true,\n              link: 'http://localhost:42001/graphql'\n            }\n          }),\n          ServerModule\n        ],\n        providers: [\n          PluginWatcherService\n        ]\n      })\n    )\n  )\n  .subscribe(() => console.log('Server started'), console.error.bind(console));\n"]}